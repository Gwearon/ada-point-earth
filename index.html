<head>
    <style>
        body {
            margin: 0;
        }
    </style>

    <script src="/lib/globe.gl.min.js"></script>
</head>

<body>
    <div id="globe"></div>

    <script>
        const initialization = ([pools, contryPolygons, populatedPlaces]) => {

            const lPoolData = pools.map(pool => {
                return {
                    text: '',
                    lat: pool.geo.lat,
                    lng: pool.geo.long,
                    size: 0.5,
                    dotRadius: 0.3,
                    color: 'rgb(240, 20, 30)',//'rgba(255, 165, 0, 0.80)'
                    altitude: 0.006
                }
            })

            const lPopulatedPlacesData = populatedPlaces.features.map(populatedPlace => {
                return {
                    text: populatedPlace.properties.name,
                    lat: populatedPlace.properties.latitude,
                    lng: populatedPlace.properties.longitude,
                    size: 0.4,
                    dotRadius: 0.2,
                    color: '#eeeeee',
                    altitude: 0.0055
                }
            })

            const lData = lPoolData.concat(lPopulatedPlacesData);

            const globeConfig = Globe()
                .globeImageUrl('/img/earth-blue-marble.jpg')
                .backgroundImageUrl('/img/night-sky.png')
                .bumpImageUrl('/img/earth-topology.png')

                .labelsData(lData)
                .labelLat('lat')
                .labelLng('lng')
                .labelText('text')
                .labelSize('size')
                .labelDotRadius('dotRadius')
                .labelColor('color') //'rgba(255, 165, 0, 0.75)')
                .labelResolution(2)
                .labelAltitude(0.0055)

                //.polygonsData(contryPolygons.features)
                .polygonCapColor(() => 'rgba(200, 0, 0, 0.0)')
                .polygonSideColor(() => 'rgba(150, 150, 150, 0.4)')
                .polygonStrokeColor(() => '#aaaaaa')
                .polygonAltitude(0.005)

            const globe = globeConfig(document.getElementById('globe'))

            setTimeout(() => {
                globe
                    .polygonsData(contryPolygons.features)
                    .polygonCapColor(() => 'rgba(200, 0, 0, 0.0)')
                    .polygonSideColor(() => 'rgba(150, 150, 150, 0.4)')
                    .polygonStrokeColor(() => '#aaaaaa')
                    .polygonAltitude(0.005)
            }, 0)

        }

        Promise.all([
            window.fetch('mainetRelays/augmentedPools.json').then(res => res.json()),
            window.fetch('geodata/countryPolygons.json').then(res => res.json()),
            window.fetch('geodata/populatedPlaces.json').then(res => res.json())
        ]).then(initialization)
    </script>
</body>